<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>You Find an Ornate Key</title>
    <link rel="stylesheet" href="styles/styles.css">

    <link rel="icon" type="image/x-icon" href="img/OrnateKeyFavIcon-144-v2.png">
</head>

<body>

    <div class="main-content">

        <div class="wrapper-scale">

            <div class="wrapper">
                <!-- Corners - Top -->
                <div class="top-row">
                    <div class="corner">
                        <div id="corner-green" class="corner-center nw"></div>
                        <img class="border-item" src="img/Sonnet-KeyWebsite-PixelCorner-NW-v2.png">
                    </div>
                    <div class="corner">
                        <div id="corner-blue" class="corner-center ne"></div>
                        <img class="border-item" src="img/Sonnet-KeyWebsite-PixelCorner-NE-v2.png">
                    </div>
                </div>
                <!-- Key -->
                <div class="middle-row">
                    <div class="key-scale">
                        <div class="key">
                            <img src="img/Sonnet-KeyWebsite-KeyBase-v1.png">
                    
                            <div class="cylinders">
                                <div class="c-green">
                                    <img id="c-green" src="img/Sonnet-KeyWebsite-KeyCylinder-Green-0-v1.png">
                                </div>
                                <div class="c-blue">
                                    <img id="c-blue" src="img/Sonnet-KeyWebsite-KeyCylinder-Blue-0-v1.png">
                                </div>
                                <div class="c-red">
                                    <img id="c-red" src="img/Sonnet-KeyWebsite-KeyCylinder-Red-0-v1.png">
                                </div>
                            </div>
                    
                            <div class="teeth">
                                <div class="t-green">
                                    <img id="t-green" src="img/Sonnet-KeyWebsite-KeyTooth-Green-0-v1.png">
                                </div>
                                <div class="t-blue">
                                    <img id="t-blue" src="img/Sonnet-KeyWebsite-KeyTooth-Blue-0-v1.png">
                                </div>
                                <div class="t-red">
                                    <img id="t-red" src="img/Sonnet-KeyWebsite-KeyTooth-Red-0-v1.png">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Corners & Lock - Bottom -->
                <div class="bottom-row">
                    <div class="corner">
                        <div id="corner-red" class="corner-center sw"></div>
                        <img class="border-item border-se" src="img/Sonnet-KeyWebsite-PixelCorner-SW-v2.png">
                    </div>
                    
                    <div class="lock-scale"><img id="lock-btn" class="lock" src="img/Sonnet-KeyWebsite-PixelCorner-UnlockButton-v2.png"></div>
                    
                    <div class="corner">
                        <img class="border-item border-se" src="img/Sonnet-KeyWebsite-PixelCorner-SE-v1.png">
                    </div>
                </div>
        
            </div>

        </div>
        
    </div>
    

    
    <script>
        // Cylinder and Teeth Storage
        const cGreen = [
            "img/Sonnet-KeyWebsite-KeyCylinder-Green-0-v1.png",
            "img/Sonnet-KeyWebsite-KeyCylinder-Green-1-v1.png",
            "img/Sonnet-KeyWebsite-KeyCylinder-Green-2-v1.png",
            "img/Sonnet-KeyWebsite-KeyCylinder-Green-3-v1.png"
        ];
    
        const tGreen = [
            "img/Sonnet-KeyWebsite-KeyTooth-Green-0-v1.png",
            "img/Sonnet-KeyWebsite-KeyTooth-Green-1-v1.png",
            "img/Sonnet-KeyWebsite-KeyTooth-Green-2-v1.png",
            "img/Sonnet-KeyWebsite-KeyTooth-Green-3-v1.png"
        ];
    
        const cBlue = [
            "img/Sonnet-KeyWebsite-KeyCylinder-Blue-0-v1.png",
            "img/Sonnet-KeyWebsite-KeyCylinder-Blue-1-v1.png",
            "img/Sonnet-KeyWebsite-KeyCylinder-Blue-2-v1.png",
            "img/Sonnet-KeyWebsite-KeyCylinder-Blue-3-v1.png"
        ];
    
        const tBlue = [
            "img/Sonnet-KeyWebsite-KeyTooth-Blue-0-v1.png",
            "img/Sonnet-KeyWebsite-KeyTooth-Blue-1-v1.png",
            "img/Sonnet-KeyWebsite-KeyTooth-Blue-2-v1.png",
            "img/Sonnet-KeyWebsite-KeyTooth-Blue-3-v1.png"
        ];
    
        const cRed = [
            "img/Sonnet-KeyWebsite-KeyCylinder-Red-0-v1.png",
            "img/Sonnet-KeyWebsite-KeyCylinder-Red-1-v1.png",
            "img/Sonnet-KeyWebsite-KeyCylinder-Red-2-v1.png",
            "img/Sonnet-KeyWebsite-KeyCylinder-Red-3-v1.png"
        ];
    
        const tRed = [
            "img/Sonnet-KeyWebsite-KeyTooth-Red-0-v1.png",
            "img/Sonnet-KeyWebsite-KeyTooth-Red-1-v1.png",
            "img/Sonnet-KeyWebsite-KeyTooth-Red-2-v1.png",
            "img/Sonnet-KeyWebsite-KeyTooth-Red-3-v1.png"
        ];
    
        // Cylander and Teeth Display
        const imgGreen = document.getElementById("c-green");
        const imgBlue = document.getElementById("c-blue");
        const imgRed = document.getElementById("c-red");
    
        const imgToothGreen = document.getElementById("t-green");
        const imgToothBlue = document.getElementById("t-blue");
        const imgToothRed = document.getElementById("t-red");
    
        // Lock Button
        const lockButton = document.getElementById("lock-btn");
    
        // Sound Definitions
        const turnSound = new Audio("audio/Bloom_SFX_YFBV_WhistleKey-TurnCylinderv3.wav");
        const lockedSound = new Audio("audio/Bloom_SFX_YFBV_WhistleKey-FailDoorUnlockv2.wav");
        const unlockSound = new Audio("audio/Bloom_SFX_YFBV_WhistleKey-UnlockDoorv3.wav");
        const successSound = new Audio("audio/Bloom_SFX_YFBV_WhistleKey-SuccessJinglev1.wav");
        const failSound = new Audio("audio/Bloom_SFX_YFBV_WhistleKey-ErrorNoisev1.wav");
        // const backSound = new Audio("audio/Bloom_SFX_YFBV_WhistleKey-GoBackv1.wav");

        // Tracking Cylindar Code
        let cylinderCode = "000"; 
        let currentIndex1 = 0;
        let currentIndex2 = 0;
        let currentIndex3 = 0;
    
        ////////////////////////////// Functions //////////////////////////////

        /////////////// Play Sounds ///////////////
        // Turn
        function playSound() {
            turnSound.currentTime = 0;
            turnSound.play();
        } 
        // Locked
        function playSoundLocked() {
            lockedSound.currentTime = 0;
            lockedSound.play();
        } 
        // Unlocked
        function playSoundUnlocked() {
            unlockSound.currentTime = 0;
            unlockSound.play();
        } 

        /////////////// Animations ///////////////
        // Shake Animation
        function triggerShake() {
            const isMobile = window.matchMedia("(max-width: 700px)").matches;
            const keyElement = document.querySelector('.key');
            const shakeClass = isMobile ? 'shake-rotated' : 'shake';

            keyElement.classList.add(shakeClass);
            setTimeout(() => {
                keyElement.classList.remove(shakeClass);
            }, 500);
        }
        
        /////////////// Cylinder Logic ///////////////
        // Update Cylinder Code On Click
        function updateCodeValue() {
            cylinderCode = `${currentIndex1}${currentIndex2}${currentIndex3}`;
            
            // Cylander testing - Remove Later
            console.log("Current code:", cylinderCode);
        }
        
        // Turn Cylinders
        imgGreen.addEventListener("click", () => {
            currentIndex1 = (currentIndex1 + 1) % cGreen.length;
            imgGreen.src = cGreen[currentIndex1];
            imgToothGreen.src = tGreen[currentIndex1];
            playSound();
            updateCodeValue();
            triggerShake();
        });
    
        imgBlue.addEventListener("click", () => {
            currentIndex2 = (currentIndex2 + 1) % cBlue.length;
            imgBlue.src = cBlue[currentIndex2];
            imgToothBlue.src = tBlue[currentIndex2];
            playSound();
            updateCodeValue();
            triggerShake();
        });
    
        imgRed.addEventListener("click", () => {
            currentIndex3 = (currentIndex3 + 1) % cRed.length;
            imgRed.src = cRed[currentIndex3];
            imgToothRed.src = tRed[currentIndex3];
            playSound();
            updateCodeValue();
            triggerShake();
        });

        // Reset Cylinder
        function resetCylinders() {
            currentIndex1 = 0;
            currentIndex2 = 0;
            currentIndex3 = 0;

            imgGreen.src = cGreen[0];
            imgToothGreen.src = tGreen[0];

            imgBlue.src = cBlue[0];
            imgToothBlue.src = tBlue[0];

            imgRed.src = cRed[0];
            imgToothRed.src = tRed[0];

            updateCodeValue();
        }
    
        /////////////// Lock Logic ///////////////
        lockButton.addEventListener("click", () => {
            const isMobile = window.matchMedia("(max-width: 700px)").matches;
            const keyElement = document.querySelector('.key');

            if (cylinderCode === "120") {
                playSoundUnlocked();

                // Trigger key bump animation (rotated on mobile)
                const bumpClass = isMobile ? 'bump-rotated' : 'key-bump';
                keyElement.classList.add(bumpClass);

                setTimeout(() => {
                    keyElement.classList.remove(bumpClass);
                    showScreen("success-screen");
                }, 1000);
                setTimeout(() => {
                    successSound.play();
                }, 2000);

            } else if (cylinderCode === "210"){
                console.log("Wrong code:", cylinderCode);
                playSoundUnlocked();

                // Trigger key bump animation (rotated on mobile)
                const bumpClass = isMobile ? 'bump-rotated' : 'key-bump';
                keyElement.classList.add(bumpClass);

                setTimeout(() => {
                    keyElement.classList.remove(shakeClass);
                    window.location.href = "success-alt-1.html";
                }, 1000);
                setTimeout(() => {
                    successSound.play();
                }, 2000);
            

             } else if (cylinderCode === "201"){
                console.log("Wrong code:", cylinderCode);
                playSoundUnlocked();

                // Trigger key bump animation (rotated on mobile)
                const bumpClass = isMobile ? 'bump-rotated' : 'key-bump';
                keyElement.classList.add(bumpClass);

                setTimeout(() => {
                    keyElement.classList.remove(shakeClass);
                    window.location.href = "succes-alt-2.html";
                }, 1000);
                setTimeout(() => {
                    successSound.play();
                }, 2000);
            
            } else {
                console.log("Wrong code:", cylinderCode);
                playSoundLocked();

                // Trigger shake animation (rotated on mobile)
                const shakeClass = isMobile ? 'shake-rotated' : 'shake';
                keyElement.classList.add(shakeClass);

                setTimeout(() => {
                    keyElement.classList.remove(shakeClass);
                    showScreen("failure-screen");
                }, 1000);
                setTimeout(() => {
                    failSound.play();
                }, 2000);
            }
        });

        /////////////// Corner Click Events ///////////////
        document.getElementById("corner-green").addEventListener("click", () => {
            showScreen("green-screen");
        });

        document.getElementById("corner-blue").addEventListener("click", () => {
            showScreen("blue-screen");
        });

        document.getElementById("corner-red").addEventListener("click", () => {
            showScreen("red-screen");
        });

        // Change Content
        function showScreen(templateId) {
            const mainContent = document.querySelector(".main-content");
            const template = document.getElementById(templateId);

            mainContent.classList.add("fade-out");

            // Wait for animation to finish before switching screens
            setTimeout(() => {
                mainContent.style.display = "none";

                // Clone and insert new screen
                const clone = template.content.cloneNode(true);
                document.body.appendChild(clone);

                // Add event for back button
                const backButton = document.getElementById("back-button");
                backButton.addEventListener("click", (event) => {
                    event.preventDefault();
                    // backSound.play();

                    setTimeout(() => {
                        const addedContent = document.querySelector(".main-content.fade-in") || document.querySelector(".main-content");
                        addedContent?.remove();

                        mainContent.style.display = "";
                        mainContent.classList.remove("fade-out");
                        mainContent.classList.add("fade-in");

                        // Remove fade-in class after animation completes (optional cleanup)
                        setTimeout(() => {
                            mainContent.classList.remove("fade-in");
                        }, 500);
                    }, 500);
                    resetCylinders();
                });
            }, 500); // Match the fade-out animation time
        }
    
    </script>

    <!-------------- TEMPLATES -------------->

    <!-- Failure Template -->
    <template id="failure-screen">
        <div class="main-content fade-in">
            <div class="wrapper-scale">
                <p class="message hint">
                    You insert the ornate key<br>
                    into the lock and blow...<br><br>
                    but nothing happens.<br><br>   
                    <a id="back-button" href="#">< go back</a>
                </p>
                </div>
        </div>
    </template>

    <!-- Green Hint Template -->
    <template id="green-screen">
        <div class="main-content fade-in">
            <div class="wrapper-scale">
                <img class="hint-img" src="img/GreenHint-Postcard.png" title="A postcard">
                <p class="message hint ">
                An old postcard commemorating the opening<br class="mobile-hide">
                of the Flats Outpost. It's hard to image<br class="mobile-hide">
                what it was like back&nbsp;then.
                <br><br>
                    <a id="back-button" href="#">< go back</a>
                </p>
            </div>
        </div>
    </template>

    <!-- Blue Hint Template -->
    <template id="blue-screen">
        <div class="main-content fade-in">
            <div class="wrapper-scale">
                <img class="blue-hint-img" src="img/BlueHint-Book-v1.png" title="A tome">
                <p class="message hint">
                An embellished tome detailing the First Pilgrimage.<br class="mobile-hide">
                On sale at Alma's Thrift... if you're okay<br class="mobile-hide">
                with a few missing&nbsp;pages.
                <br><br>
                    <a id="back-button" href="#">< go back</a>
                </p>  
            </div>
        </div>
    </template>

    <!-- Red Hint Template -->
    <template id="red-screen">
        <div class="main-content fade-in">
            <div class="wrapper-scale">
                <img class="red-hint-img" src="img/RedHint-WantedPoster-v1.png" title="A wanted poster">
                <p class="message hint">
                A worn poster with a face<br class="mobile-hide">
                you wish you could&nbsp;forget.
                <br><br>
                    <a id="back-button" href="#">< go back</a>
                </p>
            </div>
        </div>
    </template>

    <!-- Success Templates -->

    <!-- Success Template -->
    <template id="success-screen">
        <div class="wrapper-scale">
            <div class="main-content fade-in">
                <p class="message hint">
                    You insert the ornate key<br>
                    into the lock and blow...<br><br>
                    You feel the door shift open.<br><br>

                    <a id="success-1-button" href="success.html">Step inside.</a>
                </p>
            </div>
        </div>
    </template>



</body>

</html>
